// Saved object / localstorage.get('map)
{
  "0":[{'x':60,'y':60},{"n":10,"s":2,"e":"4","w":1}],
  "1":[{"x":59,"y":60},{"e":0,"n":10}],
  "10":[{"x":60,"y":61},{"n":19,"s":1,"w":1}],
  "19":[{"x":60,"y":62},{"n":20,"s":10,"w":77}],
  "20":[{"x":60,"y":63},{"n":63,"s":19,"e":27,"w":46}],
  "27":[{"x":61,"y":63},{"n":40,"s":28,"e":30,"w":20}],
  "28":[{"x":61,"y":62},{"n":27}],
  "30":[{"x":62,"y":63},{"s":31,"e":32,"w":27}],
  "31":[{"x":62,"y":62},{"n":30,"e":33}],
  "32":[{"x":63,"y":63},{"n":39,"e":54,"w":30}],
  "33":[{"x":63,"y":62},{"e":38,"w":31}],
  "38":[{"x":64,"y":62},{"s":59,"e":66,"w":33}],
  "39":[{"x":63,"y":64},{"n":53,"s":32,"e":51,"w":41}],
  "40":[{"x":61,"y":64},{"s":27}],
  "41":[{"x":62,"y":64},{"e":39}],
  "46":[{"x":59,"y":63},{"e":20,"w":62}],
  "51":[{"x":64,"y":64},{"n":69,"e":57,"w":39}],
  "53":[{"x":63,"y":65},{"n":95,"s":39,"w":88}],
  "54":[{"x":64,"y":63},{"w":32}],
  "57":[{"x":65,"y":64},{"e":145,"w":51}],
  "59":[{"x":64,"y":61},{"n":38,"s":104,"e":92}],
  "62":[{"x":58,"y":63},{"n":64,"e":46,"w":84}],
  "63":[{"x":60,"y":64},{"n":72,"s":20,"w":73}],
  "64":[{"x":58,"y":64},{"s":62,"w":82}],
  "66":[{"x":65,"y":62},{"n":169,"e":123,"w":38}],
  "69":[{"x":64,"y":65},{"n":94,"s":51,"e":103}],
  "72":[{"x":60,"y":65},{"s":63,"w":76}],
  "73":[{"x":59,"y":64},{"e":63}],
  "76":[{"x":59,"y":65},{"n":83,"e":72,"w":"?"}],
  "77":[{"x":59,"y":62},{"e":19}],
  "82":[{"x":57,"y":64},{"n":191,"e":64}],
  "83":[{"x":59,"y":66},{"s":76,"e":130,"w":125}],
  "84":[{"x":57,"y":63},{"e":62,"w":91}],
  "88":[{"x":62,"y":65},{"e":53,"w":122}],
  "91":[{"x":56,"y":63},{"n":180,"s":101,"e":84,"w":99}],
  "92":[{"x":65,"y":61},{"w":59}],
  "94":[{"x":64,"y":66},{"n":152,"s":69}],
  "95":[{"x":63,"y":66},{"n":119,"s":53,"w":115}],
  "99":[{"x":55,"y":63},{"n":190,"e":91,"w":146}],
  "101":[{"x":56,"y":62},{"n":91,"w":113}],
  "103":[{"x":65,"y":65},{"n":160,"w":69}],
  "104":[{"x":64,"y":60},{"n":59,"e":107}],
  "107":[{"x":65,"y":60},{"s":120,"e":121,"w":104}],
  "113":[{"x":55,"y":62},{"s":114,"e":101}],
  "114":[{"x":55,"y":61},{"n":113,"w":176}],
  "115":[{"x":62,"y":66},{"n":116,"e":95}],
  "116":[{"x":62,"y":67},{"n":132,"s":115}],
  "119":[{"x":63,"y":67},{"n":134,"s":95}],
  "120":[{"x":65,"y":59},{"n":107,"e":127}],
  "121":[{"x":66,"y":60},{"n":128,"e":143,"w":107}],
  "122":[{"x":61,"y":65},{"n":124,"e":88}],
  "123":[{"x":66,"y":62},{"w":66}],
  "124":[{"x":61,"y":66},{"n":157,"s":122}],
  "125":[{"x":58,"y":66},{"n":165,"e":83,"w":"?"}],
  "127":[{"x":66,"y":59},{"e":184,"w":120}],
  "128":[{"x":66,"y":61},{"s":121,"e":189}],
  "130":[{"x":60,"y":66},{"w":83}],
  "132":[{"x":62,"y":68},{"s":116}],
  "134":[{"x":63,"y":68},{"n":147,"s":119,"e":144}],
  "143":[{"x":67,"y":60},{"e":212,"w":121}],
  "144":[{"x":64,"y":68},{"e":155,"w":134}],
  "145":[{"x":66,"y":64},{"n":174,"e":220,"w":57}],
  "146":[{"x":54,"y":63},{"n":215,"s":177,"e":99,"w":257}],
  "147":[{"x":63,"y":69},{"n":200,"s":134,"e":153,"w":151}],
  "151":[{"x":62,"y":69},{"n":172,"e":147,"w":207}],
  "152":[{"x":64,"y":67},{"s":94}],
  "153":[{"x":64,"y":69},{"e":329,"w":147}],
  "155":[{"x":65,"y":68},{"s":187,"e":316,"w":144}],
  "157":[{"x":61,"y":67},{"n":210,"s":124,"w":182}],
  "160":[{"x":65,"y":66},{"s":103}],
  "165":[{"x":58,"y":67},{"n":203,"s":125,"w":204}],
  "169":[{"x":65,"y":63},{"s":66,"e":186}],
  "172":[{"x":62,"y":70},{"n":267,"s":151}],
  "174":[{"x":66,"y":65},{"n":192,"s":145,"e":224}],
  "176":[{"x":54,"y":61},{"e":114,"w":402}],
  "177":[{"x":54,"y":62},{"n":146,"w":346}],
  "180":[{"x":56,"y":64},{"s":91}],
  "182":[{"x":60,"y":67},{"e":157,"w":208}],
  "184":[{"x":67,"y":59},{"e":221,"w":127}],
  "186":[{"x":66,"y":63},{"e":205,"w":169}],
  "187":[{"x":65,"y":67},{"n":155}],
  "189":[{"x":67,"y":61},{"e":255,"w":128}],
  "190":[{"x":55,"y":64},{"s":99}],
  "191":[{"x":57,"y":65},{"s":82}],
  "192":[{"x":66,"y":66},{"n":201,"s":174,"e":223}],
  "200":[{"x":63,"y":70},{"n":227,"s":147,"e":206}],
  "201":[{"x":66,"y":67},{"s":192}],
  "203":[{"x":58,"y":68},{"n":268,"s":165,"e":299}],
  "204":[{"x":57,"y":67},{"n":219,"e":165,"w":216}],
  "205":[{"x":67,"y":63},{"s":241,"e":479,"w":186}],
  "206":[{"x":64,"y":70},{"n":288,"e":380,"w":200}],
  "207":[{"x":61,"y":69},{"n":231,"e":151,"w":290}],
  "208":[{"x":59,"y":67},{"e":182}],
  "210":[{"x":61,"y":68},{"s":157}],
  "212":[{"x":68,"y":60},{"w":143}],
  "215":[{"x":54,"y":64},{"n":246,"s":146}],
  "216":[{"x":56,"y":67},{"n":234,"e":204,"w":218}],
  "218":[{"x":55,"y":67},{"s":263,"e":216,"w":"?"}],
  "219":[{"x":57,"y":68},{"s":204}],
  "220":[{"x":67,"y":64},{"w":145}],
  "221":[{"x":68,"y":59},{"s":253,"e":240,"w":184}],
  "223":[{"x":67,"y":66},{"n":283,"w":192}],
  "224":[{"x":67,"y":65},{"w":174}],
  "227":[{"x":63,"y":71},{"n":269,"s":200}],
  "231":[{"x":61,"y":70},{"s":207,"w":248}],
  "234":[{"x":56,"y":68},{"n":368,"s":216,"w":252}],
  "240":[{"x":69,"y":59},{"n":249,"e":386,"w":221}],
  "241":[{"x":67,"y":62},{"n":205,"e":266}],
  "246":[{"x":54,"y":65},{"s":215}],
  "248":[{"x":60,"y":70},{"n":296,"e":231,"w":280}],
  "249":[{"x":69,"y":60},{"n":265,"s":240,"e":282}],
  "252":[{"x":55,"y":68},{"n":284,"e":234}],
  "253":[{"x":68,"y":58},{"n":221,"e":258}],
  "255":[{"x":68,"y":61},{"w":189}],
  "257":[{"x":53,"y":63},{"n":320,"e":146,"w":364}],
  "258":[{"x":69,"y":58},{"e":306,"w":253}],
  "263":[{"x":55,"y":66},{"n":218}],
  "265":[{"x":69,"y":61},{"n":279,"s":249,"e":270}],
  "266":[{"x":68,"y":62},{"w":241}],
  "267":[{"x":62,"y":71},{"n":285,"s":172,"w":271}],
  "268":[{"x":58,"y":69},{"s":203,"e":411,"w":312}],
  "269":[{"x":63,"y":72},{"n":319,"s":227}],
  "270":[{"x":70,"y":61},{"n":416,"e":338,"w":265}],
  "271":[{"x":61,"y":71},{"n":337,"e":267}],
  "279":[{"x":69,"y":62},{"s":265}],
  "280":[{"x":59,"y":70},{"n":325,"e":248}],
  "282":[{"x":70,"y":60},{"w":249}],
  "283":[{"x":67,"y":67},{"n":331,"s":223,"e":313}],
  "284":[{"x":55,"y":69},{"n":302,"s":252,"w":303}],
  "285":[{"x":62,"y":72},{"n":286,"s":267}],
  "286":[{"x":62,"y":73},{"n":336,"s":285,"w":291}],
  "288":[{"x":64,"y":71},{"s":206}],
  "290":[{"x":60,"y":69},{"e":207}],
  "291":[{"x":61,"y":73},{"n":410,"e":286,"w":347}],
  "296":[{"x":60,"y":71},{"s":248}],
  "299":[{"x":59,"y":68},{"e":311,"w":203}],
  "302":[{"x":55,"y":70},{"n":422,"s":284}],
  "303":[{"x":54,"y":69},{"n":361,"e":284,"w":405}],
  "306":[{"x":70,"y":58},{"e":397,"w":258}],
  "311":[{"x":60,"y":68},{"w":299}],
  "312":[{"x":57,"y":69},{"n":328,"e":268}],
  "313":[{"x":68,"y":67},{"w":283}],
  "316":[{"x":66,"y":68},{"n":344,"w":155}],
  "319":[{"x":63,"y":73},{"n":359,"s":269,"e":345}],
  "320":[{"x":53,"y":64},{"n":348,"s":257}],
  "325":[{"x":59,"y":71},{"n":353,"s":280,"w":374}],
  "328":[{"x":57,"y":70},{"n":332,"s":312,"e":357,"w":363}],
  "329":[{"x":65,"y":69},{"w":153}],
  "331":[{"x":67,"y":68},{"s":283,"e":446}],
  "332":[{"x":57,"y":71},{"n":350,"s":328}],
  "336":[{"x":62,"y":74},{"s":286}],
  "337":[{"x":61,"y":72},{"s":271}],
  "338":[{"x":71,"y":61},{"s":379,"w":270}],
  "344":[{"x":66,"y":69},{"n":392,"s":316,"e":390}],
  "345":[{"x":64,"y":73},{"s":375,"w":319}],
  "346":[{"x":53,"y":62},{"e":177}],
  "347":[{"x":60,"y":73},{"n":452,"s":442,"e":291}],
  "348":[{"x":53,"y":65},{"s":320}],
  "350":[{"x":57,"y":72},{"n":436,"s":332,"e":404}],
  "353":[{"x":59,"y":72},{"s":325}],
  "357":[{"x":58,"y":70},{"w":328}],
  "359":[{"x":63,"y":74},{"s":319}],
  "361":[{"x":54,"y":70},{"n":408,"s":303}],
  "363":[{"x":56,"y":70},{"n":372,"e":328}],
  "364":[{"x":52,"y":63},{"n":429,"s":381,"e":257,"w":448}],
  "368":[{"x":56,"y":69},{"s":234}],
  "372":[{"x":56,"y":71},{"n":441,"s":363}],
  "374":[{"x":58,"y":71},{"e":325}],
  "375":[{"x":64,"y":72},{"n":345,"e":385}],
  "379":[{"x":71,"y":60},{"n":338,"e":395}],
  "380":[{"x":65,"y":70},{"n":424,"w":206}],
  "381":[{"x":52,"y":62},{"n":364,"w":394}],
  "385":[{"x":65,"y":72},{"w":375}],
  "386":[{"x":70,"y":59},{"e":414,"w":240}],
  "390":[{"x":67,"y":69},{"w":344}],
  "392":[{"x":66,"y":70},{"s":344,"e":462}],
  "394":[{"x":51,"y":62},{"e":381}],
  "395":[{"x":72,"y":60},{"s":403,"e":421,"w":379}],
  "397":[{"x":71,"y":58},{"w":306}],
  "402":[{"x":53,"y":61},{"e":176,"w":451}],
  "403":[{"x":72,"y":59},{"n":395}],
  "404":[{"x":58,"y":72},{"n":481,"w":350}],
  "405":[{"x":53,"y":69},{"n":406,"e":303}],
  "406":[{"x":53,"y":70},{"s":405,"w":415}],
  "408":[{"x":54,"y":71},{"n":458,"s":361,"w":423}],
  "410":[{"x":61,"y":74},{"s":291}],
  "411":[{"x":59,"y":69},{"w":268}],
  "414":[{"x":71,"y":59},{"w":386}],
  "415":[{"x":52,"y":70},{"e":406,"w":418}],
  "416":[{"x":70,"y":62},{"s":270}],
  "418":[{"x":51,"y":70},{"n":425,"s":474,"e":415}],
  "421":[{"x":73,"y":60},{"n":440,"w":395}],
  "422":[{"x":55,"y":71},{"n":426,"s":302}],
  "423":[{"x":53,"y":71},{"e":408,"w":454}],
  "424":[{"x":65,"y":71},{"s":380,"e":473}],
  "425":[{"x":51,"y":71},{"s":418,"w":469}],
  "426":[{"x":55,"y":72},{"n":457,"s":422}],
  "429":[{"x":52,"y":64},{"s":364}],
  "436":[{"x":57,"y":73},{"s":350}],
  "440":[{"x":73,"y":61},{"s":421,"w":476}],
  "441":[{"x":56,"y":72},{"s":372}],
  "442":[{"x":60,"y":72},{"n":347}],
  "446":[{"x":68,"y":68},{"e":466,"w":331}],
  "448":[{"x":51,"y":63},{"e":364}],
  "451":[{"x":52,"y":61},{"e":402,"w":453}],
  "452":[{"x":60,"y":74},{"s":347}],
  "453":[{"x":51,"y":61},{"s":464,"e":451}],
  "454":[{"x":52,"y":71},{"n":470,"e":423}],
  "457":[{"x":55,"y":73},{"n":461,"s":426}],
  "458":[{"x":54,"y":72},{"s":408,"w":459}],
  "459":[{"x":53,"y":72},{"e":458}],
  "461":[{"x":55,"y":74},{"s":457}],
  "462":[{"x":67,"y":70},{"w":392}],
  "464":[{"x":51,"y":60},{"n":453}],
  "466":[{"x":69,"y":68},{"s":486,"e":472,"w":446}],
  "469":[{"x":50,"y":71},{"e":425}],
  "470":[{"x":52,"y":72},{"s":454}],
  "472":[{"x":70,"y":68},{"w":466}],
  "473":[{"x":66,"y":71},{"e":494,"w":424}],
  "474":[{"x":51,"y":69},{"n":418}],
  "476":[{"x":72,"y":61},{"e":440}],
  "479":[{"x":68,"y":63},{"w":205}],
  "481":[{"x":58,"y":73},{"s":404}],
  "486":[{"x":69,"y":67},{"n":466}],
  "494":[{"x":67,"y":71},{"w":473}]
}

constructor(){
  super()
  this.state = {
    url : "https://lambda-treasure-hunt.herokuapp.com/api/adv/",
    config : {headers:{"Authorization":"Token 78d053a88abb09f2c77e9d6146b585bd54629049"}},
    initRoom : {},
    currrentRoom : 0,
    exits : {},
    coordinates : '',
    cooldown : 0,
    visited : {
      0: { n: "?", s: "?", w: "?", e: "?" }
    },
    last : {},
    traversal : [],
    numOfRoomsVisited : 1,
    // set default to 1 since we start out in a room
  }
}
createMap(){
  let visited = {}
  visited[0] = {"n":"?","s":"?","w":"?","e":"?"}
  let checked = []
  let returnedList = []
  // console.log(Object.keys(visited).length)
  
    while(Object.keys(visited).length < 499){
      // console.log("this is the init id thing: ", this.state.initRoom.room_id)
      if(!visited[this.state.initRoom.room_id]){
        visited[this.state.initRoom.room_id] = this.state.initRoom.exits
        // visited[this.state.initRoom.room_id].del(checked[-1])
      }
      console.log("VISITED ==> ", visited)
      // console.log("STATE ==>", this.state)
      console.log(this.state.currrentRoom)
      while(visited[this.state.initRoom.room_id].length === 0 && checked.length > 0){
        // let prevNode = checked.pop(0)
        let prevNode = checked.shift()
        returnedList.push(prevNode)
        this.moveRooms(prevNode)
        this.initReq()
      }
    
      let step = visited[this.state.initRoom.room_id].pop(0)
      // save the first element in visited[room_id]
      // delete the first element in visited[room_id]
      // let step = Object.keys(visited[this.state.initRoom.room_id][0])

      checked.push(this.oppositeDirection(step))
      returnedList.push(step)
      setTimeout(this.moveRooms(step),15000)
      this.initReq()
  }
localStorage.setItem('traversal', visited)
}

moveRooms = dir => {
  console.log("called!")
  let c = this.state.config
  // had to do this to call it in post request
  axios.post(`${this.state.url}move`, {direction: dir}, c)
  .then(res => {
    this.setState({ initRoom: res.data , last:res.data});
    this.updateState(res.data)
    console.log(res.data)
  })
  .catch(err => {
    console.log(err);
  });
};

oppositeDirection(direction){
  if(direction === "n"){
    return "s"
  }
  if(direction === "s"){
    return "n"
  }
  if(direction === "e"){
    return "w"
  }
  if(direction === "w"){
    return "e"
  }
}

componentDidMount=()=>{
  this.initReq()
  // setTimeout(()=>{this.createMap()}, 1000)
  // this.createMap()
  
}

initReq(){
  console.log("init line 56")
  axios.get(`${this.state.url}init`, this.state.config)
  .then(res => {
    this.setState({initRoom:res.data})
    // this.updateState(res.data)
    console.log(res.data.exits)
  })
  .catch(err => {
    console.log(err)
  })
}

updateState = res => {
  if ("room_id" in res) {
    this.setState({
      currentRoom: res.room_id,
      exits: res.exits,
      coordinates: res.coordinates,
      cooldown: res.cooldown
    });
  }
};

unexploredDirection = () => {
  let exits = this.state.exits;
  let current = this.state.currentRoom;
  let visited = this.state.visited;
  let unexplored = [];
  let directions = ["n", "s", "e", "w"];

  for (let i = 0; i < directions.length; i++) {
    if (exits.includes(directions[i])) {
      if (visited[current][directions[i]] === "?") {
        unexplored.push(directions[i]);
      }
    } else {
      visited[current][directions[i]] = "-";
    }
  }

  this.setState({ visited: visited });

  if (unexplored.length === 0) {
    return null;
  } else {
    return unexplored[Math.floor(Math.random(unexplored.length))];
  }
};

save = (currentRoom, nextRoom, direction) => {
  let traversal= this.state.traversal;
  let visited = this.state.visited;
  let numExplored = this.state.numOfRoomsVisited;

  traversal.push(direction);
  if(nextRoom in visited){/*pass*/} 
  else{
    visited[nextRoom] = { n: "?", s: "?", w: "?", e: "?" };
    numExplored++;
  }
  visited[currentRoom][direction] = nextRoom;
  visited[nextRoom][this.oppositeDirection(direction)] = currentRoom;

  this.setState(traversal, visited, numExplored);
};

handleDirectionClick = (e, direction) =>{
  e.preventDefault()
  e.stopPropagation()
  this.moveRooms(direction)
}
